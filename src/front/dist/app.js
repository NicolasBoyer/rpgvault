/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const K=window,ge=K.ShadowRoot&&(K.ShadyCSS===void 0||K.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,He=Symbol(),ve=new WeakMap;let Ye=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==He)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(ge&&e===void 0){const s=t!==void 0&&t.length===1;s&&(e=ve.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&ve.set(t,e))}return e}toString(){return this.cssText}};const We=n=>new Ye(typeof n=="string"?n:n+"",void 0,He),Ke=(n,e)=>{ge?n.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):e.forEach(t=>{const s=document.createElement("style"),i=K.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=t.cssText,n.appendChild(s)})},$e=ge?n=>n:n=>n instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return We(t)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var ee;const Z=window,be=Z.trustedTypes,Je=be?be.emptyScript:"",we=Z.reactiveElementPolyfillSupport,de={toAttribute(n,e){switch(e){case Boolean:n=n?Je:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,e){let t=n;switch(e){case Boolean:t=n!==null;break;case Number:t=n===null?null:Number(n);break;case Object:case Array:try{t=JSON.parse(n)}catch{t=null}}return t}},Ue=(n,e)=>e!==n&&(e==e||n==n),te={attribute:!0,type:String,converter:de,reflect:!1,hasChanged:Ue},ce="finalized";let N=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),((t=this.h)!==null&&t!==void 0?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach((t,s)=>{const i=this._$Ep(s,t);i!==void 0&&(this._$Ev.set(i,s),e.push(i))}),e}static createProperty(e,t=te){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const s=typeof e=="symbol"?Symbol():"__"+e,i=this.getPropertyDescriptor(e,s,t);i!==void 0&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(i){const o=this[e];this[t]=i,this.requestUpdate(e,o,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||te}static finalize(){if(this.hasOwnProperty(ce))return!1;this[ce]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,s=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of s)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const i of s)t.unshift($e(i))}else e!==void 0&&t.push($e(e));return t}static _$Ep(e,t){const s=t.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(t=>t(this))}addController(e){var t,s;((t=this._$ES)!==null&&t!==void 0?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((s=e.hostConnected)===null||s===void 0||s.call(e))}removeController(e){var t;(t=this._$ES)===null||t===void 0||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])})}createRenderRoot(){var e;const t=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return Ke(t,this.constructor.elementStyles),t}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(t=>{var s;return(s=t.hostConnected)===null||s===void 0?void 0:s.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(t=>{var s;return(s=t.hostDisconnected)===null||s===void 0?void 0:s.call(t)})}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EO(e,t,s=te){var i;const o=this.constructor._$Ep(e,s);if(o!==void 0&&s.reflect===!0){const a=(((i=s.converter)===null||i===void 0?void 0:i.toAttribute)!==void 0?s.converter:de).toAttribute(t,s.type);this._$El=e,a==null?this.removeAttribute(o):this.setAttribute(o,a),this._$El=null}}_$AK(e,t){var s;const i=this.constructor,o=i._$Ev.get(e);if(o!==void 0&&this._$El!==o){const a=i.getPropertyOptions(o),d=typeof a.converter=="function"?{fromAttribute:a.converter}:((s=a.converter)===null||s===void 0?void 0:s.fromAttribute)!==void 0?a.converter:de;this._$El=o,this[o]=d.fromAttribute(t,a.type),this._$El=null}}requestUpdate(e,t,s){let i=!0;e!==void 0&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||Ue)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),s.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((i,o)=>this[o]=i),this._$Ei=void 0);let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),(e=this._$ES)===null||e===void 0||e.forEach(i=>{var o;return(o=i.hostUpdate)===null||o===void 0?void 0:o.call(i)}),this.update(s)):this._$Ek()}catch(i){throw t=!1,this._$Ek(),i}t&&this._$AE(s)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)===null||t===void 0||t.forEach(s=>{var i;return(i=s.hostUpdated)===null||i===void 0?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((t,s)=>this._$EO(s,this[s],t)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};N[ce]=!0,N.elementProperties=new Map,N.elementStyles=[],N.shadowRootOptions={mode:"open"},we==null||we({ReactiveElement:N}),((ee=Z.reactiveElementVersions)!==null&&ee!==void 0?ee:Z.reactiveElementVersions=[]).push("1.6.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var se;const G=window,O=G.trustedTypes,Ae=O?O.createPolicy("lit-html",{createHTML:n=>n}):void 0,he="$lit$",L=`lit$${(Math.random()+"").slice(9)}$`,De="?"+L,Ze=`<${De}>`,H=document,j=()=>H.createComment(""),F=n=>n===null||typeof n!="object"&&typeof n!="function",Ne=Array.isArray,Ge=n=>Ne(n)||typeof(n==null?void 0:n[Symbol.iterator])=="function",ie=`[ 	
\f\r]`,V=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Se=/-->/g,xe=/>/g,P=RegExp(`>|${ie}(?:([^\\s"'>=/]+)(${ie}*=${ie}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ke=/'/g,Ce=/"/g,_e=/^(?:script|style|textarea|title)$/i,Qe=n=>(e,...t)=>({_$litType$:n,strings:e,values:t}),g=Qe(1),R=Symbol.for("lit-noChange"),A=Symbol.for("lit-nothing"),Be=new WeakMap,T=H.createTreeWalker(H,129,null,!1);function Oe(n,e){if(!Array.isArray(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ae!==void 0?Ae.createHTML(e):e}const et=(n,e)=>{const t=n.length-1,s=[];let i,o=e===2?"<svg>":"",a=V;for(let d=0;d<t;d++){const r=n[d];let u,v,$=-1,x=0;for(;x<r.length&&(a.lastIndex=x,v=a.exec(r),v!==null);)x=a.lastIndex,a===V?v[1]==="!--"?a=Se:v[1]!==void 0?a=xe:v[2]!==void 0?(_e.test(v[2])&&(i=RegExp("</"+v[2],"g")),a=P):v[3]!==void 0&&(a=P):a===P?v[0]===">"?(a=i??V,$=-1):v[1]===void 0?$=-2:($=a.lastIndex-v[2].length,u=v[1],a=v[3]===void 0?P:v[3]==='"'?Ce:ke):a===Ce||a===ke?a=P:a===Se||a===xe?a=V:(a=P,i=void 0);const M=a===P&&n[d+1].startsWith("/>")?" ":"";o+=a===V?r+Ze:$>=0?(s.push(u),r.slice(0,$)+he+r.slice($)+L+M):r+L+($===-2?(s.push(void 0),d):M)}return[Oe(n,o+(n[t]||"<?>")+(e===2?"</svg>":"")),s]};class q{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let o=0,a=0;const d=e.length-1,r=this.parts,[u,v]=et(e,t);if(this.el=q.createElement(u,s),T.currentNode=this.el.content,t===2){const $=this.el.content,x=$.firstChild;x.remove(),$.append(...x.childNodes)}for(;(i=T.nextNode())!==null&&r.length<d;){if(i.nodeType===1){if(i.hasAttributes()){const $=[];for(const x of i.getAttributeNames())if(x.endsWith(he)||x.startsWith(L)){const M=v[a++];if($.push(x),M!==void 0){const Xe=i.getAttribute(M.toLowerCase()+he).split(L),Y=/([.?@])?(.*)/.exec(M);r.push({type:1,index:o,name:Y[2],strings:Xe,ctor:Y[1]==="."?st:Y[1]==="?"?nt:Y[1]==="@"?ot:Q})}else r.push({type:6,index:o})}for(const x of $)i.removeAttribute(x)}if(_e.test(i.tagName)){const $=i.textContent.split(L),x=$.length-1;if(x>0){i.textContent=O?O.emptyScript:"";for(let M=0;M<x;M++)i.append($[M],j()),T.nextNode(),r.push({type:2,index:++o});i.append($[x],j())}}}else if(i.nodeType===8)if(i.data===De)r.push({type:2,index:o});else{let $=-1;for(;($=i.data.indexOf(L,$+1))!==-1;)r.push({type:7,index:o}),$+=L.length-1}o++}}static createElement(e,t){const s=H.createElement("template");return s.innerHTML=e,s}}function z(n,e,t=n,s){var i,o,a,d;if(e===R)return e;let r=s!==void 0?(i=t._$Co)===null||i===void 0?void 0:i[s]:t._$Cl;const u=F(e)?void 0:e._$litDirective$;return(r==null?void 0:r.constructor)!==u&&((o=r==null?void 0:r._$AO)===null||o===void 0||o.call(r,!1),u===void 0?r=void 0:(r=new u(n),r._$AT(n,t,s)),s!==void 0?((a=(d=t)._$Co)!==null&&a!==void 0?a:d._$Co=[])[s]=r:t._$Cl=r),r!==void 0&&(e=z(n,r._$AS(n,e.values),r,s)),e}class tt{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:s},parts:i}=this._$AD,o=((t=e==null?void 0:e.creationScope)!==null&&t!==void 0?t:H).importNode(s,!0);T.currentNode=o;let a=T.nextNode(),d=0,r=0,u=i[0];for(;u!==void 0;){if(d===u.index){let v;u.type===2?v=new X(a,a.nextSibling,this,e):u.type===1?v=new u.ctor(a,u.name,u.strings,this,e):u.type===6&&(v=new at(a,this,e)),this._$AV.push(v),u=i[++r]}d!==(u==null?void 0:u.index)&&(a=T.nextNode(),d++)}return T.currentNode=H,o}v(e){let t=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class X{constructor(e,t,s,i){var o;this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$Cp=(o=i==null?void 0:i.isConnected)===null||o===void 0||o}get _$AU(){var e,t;return(t=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&t!==void 0?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=z(this,e,t),F(e)?e===A||e==null||e===""?(this._$AH!==A&&this._$AR(),this._$AH=A):e!==this._$AH&&e!==R&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Ge(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==A&&F(this._$AH)?this._$AA.nextSibling.data=e:this.$(H.createTextNode(e)),this._$AH=e}g(e){var t;const{values:s,_$litType$:i}=e,o=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=q.createElement(Oe(i.h,i.h[0]),this.options)),i);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===o)this._$AH.v(s);else{const a=new tt(o,this),d=a.u(this.options);a.v(s),this.$(d),this._$AH=a}}_$AC(e){let t=Be.get(e.strings);return t===void 0&&Be.set(e.strings,t=new q(e)),t}T(e){Ne(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const o of e)i===t.length?t.push(s=new X(this.k(j()),this.k(j()),this,this.options)):s=t[i],s._$AI(o),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var s;for((s=this._$AP)===null||s===void 0||s.call(this,!1,!0,t);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var t;this._$AM===void 0&&(this._$Cp=e,(t=this._$AP)===null||t===void 0||t.call(this,e))}}class Q{constructor(e,t,s,i,o){this.type=1,this._$AH=A,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=o,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=A}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,i){const o=this.strings;let a=!1;if(o===void 0)e=z(this,e,t,0),a=!F(e)||e!==this._$AH&&e!==R,a&&(this._$AH=e);else{const d=e;let r,u;for(e=o[0],r=0;r<o.length-1;r++)u=z(this,d[s+r],t,r),u===R&&(u=this._$AH[r]),a||(a=!F(u)||u!==this._$AH[r]),u===A?e=A:e!==A&&(e+=(u??"")+o[r+1]),this._$AH[r]=u}a&&!i&&this.j(e)}j(e){e===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class st extends Q{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===A?void 0:e}}const it=O?O.emptyScript:"";class nt extends Q{constructor(){super(...arguments),this.type=4}j(e){e&&e!==A?this.element.setAttribute(this.name,it):this.element.removeAttribute(this.name)}}class ot extends Q{constructor(e,t,s,i,o){super(e,t,s,i,o),this.type=5}_$AI(e,t=this){var s;if((e=(s=z(this,e,t,0))!==null&&s!==void 0?s:A)===R)return;const i=this._$AH,o=e===A&&i!==A||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,a=e!==A&&(i===A||o);o&&this.element.removeEventListener(this.name,this,i),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;typeof this._$AH=="function"?this._$AH.call((s=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&s!==void 0?s:this.element,e):this._$AH.handleEvent(e)}}class at{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){z(this,e)}}const Me=G.litHtmlPolyfillSupport;Me==null||Me(q,X),((se=G.litHtmlVersions)!==null&&se!==void 0?se:G.litHtmlVersions=[]).push("2.7.5");const E=(n,e,t)=>{var s,i;const o=(s=t==null?void 0:t.renderBefore)!==null&&s!==void 0?s:e;let a=o._$litPart$;if(a===void 0){const d=(i=t==null?void 0:t.renderBefore)!==null&&i!==void 0?i:null;o._$litPart$=a=new X(e.insertBefore(j(),d),d,void 0,t??{})}return a._$AI(n),a};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var ne,oe;class J extends N{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const s=super.createRenderRoot();return(e=(t=this.renderOptions).renderBefore)!==null&&e!==void 0||(t.renderBefore=s.firstChild),s}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=E(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return R}}J.finalized=!0,J._$litElement$=!0,(ne=globalThis.litElementHydrateSupport)===null||ne===void 0||ne.call(globalThis,{LitElement:J});const Ee=globalThis.litElementPolyfillSupport;Ee==null||Ee({LitElement:J});((oe=globalThis.litElementVersions)!==null&&oe!==void 0?oe:globalThis.litElementVersions=[]).push("3.3.2");class Re{static newDom(e){return this.setCurrent(e)}static setCurrent(e){return this.currentElement=e,this}static elt(e,t=""){const s=document.createElement(e);return t&&(s.className=t),this.currentElement.appendChild(s),this.currentElement=s,this}static svg(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add(e);const s=document.createElementNS("http://www.w3.org/2000/svg","use");return t.appendChild(s),s.setAttribute("href",`#${e}`),this.currentElement.appendChild(t),this.currentElement=t,this}static att(e,t){return t!==null&&this.currentElement.setAttribute(e,t),this}static text(e){return e!==null&&this.currentElement.appendChild(document.createTextNode(e)),this}static listen(e,t){return this.currentElement.addEventListener(e,t,!1),this}static up(){return this.currentElement=this.currentElement.parentNode,this.currentElement||(this.currentElement=document.body),this}static clear(){return this.currentElement.innerHTML="",this}static current(){return this.currentElement}static remove(){this.currentElement.remove()}}const rt=(n,e)=>e.some(t=>n instanceof t);let Ie,Le;function lt(){return Ie||(Ie=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dt(){return Le||(Le=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ze=new WeakMap,ue=new WeakMap,Ve=new WeakMap,ae=new WeakMap,pe=new WeakMap;function ct(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(I(n.result)),i()},a=()=>{s(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&ze.set(t,n)}).catch(()=>{}),pe.set(e,n),e}function ht(n){if(ue.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});ue.set(n,e)}let fe={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ue.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ve.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return I(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ut(n){fe=n(fe)}function ft(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(re(this),e,...t);return Ve.set(s,e.sort?e.sort():[e]),I(s)}:dt().includes(n)?function(...e){return n.apply(re(this),e),I(ze.get(this))}:function(...e){return I(n.apply(re(this),e))}}function mt(n){return typeof n=="function"?ft(n):(n instanceof IDBTransaction&&ht(n),rt(n,lt())?new Proxy(n,fe):n)}function I(n){if(n instanceof IDBRequest)return ct(n);if(ae.has(n))return ae.get(n);const e=mt(n);return e!==n&&(ae.set(n,e),pe.set(e,n)),e}const re=n=>pe.get(n);function Pe(n,e,{blocked:t,upgrade:s,blocking:i,terminated:o}={}){const a=indexedDB.open(n,e),d=I(a);return s&&a.addEventListener("upgradeneeded",r=>{s(I(a.result),r.oldVersion,r.newVersion,I(a.transaction),r)}),t&&a.addEventListener("blocked",r=>t(r.oldVersion,r.newVersion,r)),d.then(r=>{o&&r.addEventListener("close",()=>o()),i&&r.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),d}function gt(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",s=>e(s.oldVersion,s)),I(t).then(()=>{})}const pt=["get","getKey","getAll","getAllKeys","count"],yt=["put","add","delete","clear"],le=new Map;function Te(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(le.get(e))return le.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=yt.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||pt.includes(t)))return;const o=async function(a,...d){const r=this.transaction(a,i?"readwrite":"readonly");let u=r.store;return s&&(u=u.index(d.shift())),(await Promise.all([u[t](...d),i&&r.done]))[0]};return le.set(e,o),o}ut(n=>({...n,get:(e,t,s)=>Te(e,t)||n.get(e,t,s),has:(e,t)=>!!Te(e,t)||n.has(e,t)}));const me=[];class C{static async set(e,...t){for(let s=0;s<t.length;s++){const i=5242880-JSON.stringify(sessionStorage).length,o=JSON.stringify(t[s+1]);if(o&&o.length>=i||e){const a=t[s],d=await Pe(t[s],1,{upgrade:v=>v.createObjectStore(t[s])});me.push(a),await d.transaction(a,"readwrite").objectStore(a).put(t[s+1],a),d.close();return}s%2===0&&sessionStorage.setItem(t[s],o)}}static async get(...e){let t=[];for(const s of e)if(me.includes(s)){const i=await Pe(s,1);t.push(await i.transaction(s).objectStore(s).get(s))}else t.push(JSON.parse(sessionStorage.getItem(s)));return t=t.filter(s=>s),t.length===1&&t.length===e.length?t[0]:t.length&&t.length===e.length?t:null}}window.addEventListener("beforeunload",()=>me.forEach(n=>gt(n)));class m{static helpers({confirmMessage:e="",cbConfirm:t=null,cbCancel:s=null,isConfirmInit:i=!0,loaderVisible:o=!1}={}){const a=t,d=s;E(g`
			<fs-loader ?visible="${o}"></fs-loader>
			<fs-confirm .message="${e}" ?open="${i?!i:Math.random()}" @modalConfirm="${()=>a()}" @modalCancel="${()=>d()}"></fs-confirm>
		`,document.body)}static loader(e){this.helpers({loaderVisible:e})}static confirm(e,t,s=null){this.helpers({confirmMessage:e,cbConfirm:t,cbCancel:s,isConfirmInit:!1})}static toast(e,t){Re.newDom(document.body).elt("fs-toast").att("type",e).att("message",t)}static async request(e,t="GET",s={},i=""){const o=await fetch(e,{method:t,...s});if(i==="status"&&t==="HEAD")return o.status;if(o.status!==200&&o.status!==204)console.error("Request failed : "+o.status),console.log(o);else switch(i){case"blob":return o.blob();case"text":return o.text();case"response":return o;default:return o.json()}}static async getFragmentHtml(e){const t=await C.get(e)||await m.request(e,"POST");return C.set(!1,e,t),t}static generateId(){return new Date().getTime()}static getMousePosition(){return{x:je,y:Fe}}static async getBase64FromFileReader(e){return new Promise((t,s)=>{const i=new FileReader;i.addEventListener("load",()=>t(i.result)),i.addEventListener("error",()=>s),i.readAsDataURL(e)})}static slugify(e){const t="ãàáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/-,:;",s="aaaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh______",i=new RegExp(t.split("").join("|"),"g");return e.toString().toLowerCase().replace(/\s+/g,"_").replace(i,o=>s.charAt(t.indexOf(o))).replace(/&/g,"_and_").replace(/[^\w\-]+/g,"").replace(/--+/g,"_").replace(/^-+/,"").replace(/-+$/,"")}static replaceChildren(e,...t){if(e.replaceChildren)return e.replaceChildren(...t);e.textContent="";for(const s of t)e.appendChild(s)}static urlToBase64(e){return new Promise(async t=>{const s=new FileReader;s.onload=()=>t(s.result),s.readAsDataURL(await this.request(e,"GET",null,"blob"))})}static async uploadFileAndGetUrl(e,t=null){var i;const s=new FormData;return s.append("file",e),t&&s.append("public_id",t),s.append("upload_preset","sheetrpg"),(i=await m.request("https://api.cloudinary.com/v1_1/elendil/upload","POST",{body:s}))==null?void 0:i.secure_url}static isValidHttpUrl(e){return new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}}let je=0,Fe=0;document.body.addEventListener("pointermove",n=>{je=n.pageX+window.scrollX,Fe=n.pageY+window.scrollY});class vt extends HTMLElement{static get observedAttributes(){return["visible"]}get visible(){return this.hasAttribute("visible")}set visible(e){e?this.setAttribute("visible",""):this.removeAttribute("visible")}connectedCallback(){this.render(),this.style.display="none"}attributeChangedCallback(e,t,s){e==="visible"&&t!==s&&(s===""&&(this.style.display="",setTimeout(()=>this.render(),20)),s===null&&(this.style.display="none",setTimeout(()=>this.render(),20)))}render(){E(g`<div class="spinner"></div>`,this)}}const f=class f{static init(e,t,s){e.selector=e.querySelector("input, textarea")||e,this.elements[e.selector.id]=e,this.offsetPosition=t,e.resizerCallback=s,this.mouse={x:0,y:0,translateX:0,translateY:0,originalX:0,originalY:0},this.selectedSelectorId=e.selector.id,window.addEventListener("resize",()=>this.resetHandler(e)),this.resetHandler(e),document.body.addEventListener("pointermove",this.pointerMove),document.body.addEventListener("pointerup",this.pointerUp)}static resetHandler(e){const t=e.getBoundingClientRect(),s=15,i=[{top:0,left:0,class:"leftTop"},{top:t.height/2,left:0,class:"leftCenter"},{top:t.height,left:0,class:"leftBottom"},{top:0,left:t.width/2,class:"centerTop"},{top:t.height,left:t.width/2,class:"centerBottom"},{top:0,left:t.width,class:"rightTop"},{top:t.height/2,left:t.width,class:"rightCenter"},{top:t.height,left:t.width,class:"rightBottom"}];for(const o of i){const a=e.querySelector(`.${o.class}`);a&&(a.setAttribute("style",`top: ${o.top-s/2}px;left: ${o.left-s/2}px;width: ${s}px;height: ${s}px;border-radius: ${s}px;`),a.addEventListener("pointerdown",this.pointerDown))}}static pointerDown(e){var s;f.mouse.originalX=e.pageX,f.mouse.originalY=e.pageY;const t=e.target;f.leftHorizontalMove=t.className.includes("left"),f.rightHorizontalMove=t.className.includes("right"),f.topVerticalMove=t.className.includes("Top"),f.bottomVerticalMove=t.className.includes("Bottom"),f.selectedSelectorId=((s=t.parentElement)==null?void 0:s.firstElementChild).id||t.parentElement.id,f.width=f.elements[f.selectedSelectorId].getBoundingClientRect().width,f.height=f.elements[f.selectedSelectorId].getBoundingClientRect().height,f.isPointerDown=!0,document.body.classList.add("isResizing")}static pointerMove(e){e.returnValue=!1,f.mouse.x=e.pageX-f.mouse.originalX,f.mouse.y=e.pageY-f.mouse.originalY;const t=f.elements[f.selectedSelectorId],s=new WebKitCSSMatrix(getComputedStyle(t).transform);f.mouse.translateX=s.m41,f.mouse.translateY=s.m42,e.pressure!==0&&f.isPointerDown&&(f.leftHorizontalMove&&(f.mouse.translateX=e.pageX+window.scrollX-f.offsetPosition.x,t.selector.style.width=f.width-f.mouse.x+"px"),f.rightHorizontalMove&&(t.selector.style.width=f.width+f.mouse.x+"px"),f.topVerticalMove&&(f.mouse.translateY=e.pageY+window.scrollY-f.offsetPosition.y,t.selector.style.height=f.height-f.mouse.y+"px"),f.bottomVerticalMove&&(t.selector.style.height=f.height+f.mouse.y+"px"),t.style.transform=`translate(${f.mouse.translateX}px, ${f.mouse.translateY}px)`,f.resetHandler(t))}static async pointerUp(){if(f.isPointerDown){const e=f.elements[f.selectedSelectorId];await e.resizerCallback({x:f.mouse.translateX,y:f.mouse.translateY,width:parseInt(e.selector.style.width),height:parseInt(e.selector.style.height)}),f.isPointerDown=!1,document.body.classList.remove("isResizing")}}};f.elements={},f.isPointerDown=!1,f.boxPositions=[{class:"leftTop"},{class:"leftCenter"},{class:"leftBottom"},{class:"centerTop"},{class:"centerBottom"},{class:"rightTop"},{class:"rightCenter"},{class:"rightBottom"}];let U=f;const B=class B{static set(e,t,s){this.shortCuts[t.join()]={element:e,keys:t,action:s},e==null||e.addEventListener("keydown",this.keyDown),e==null||e.addEventListener("keyup",this.keyUp)}static keyDown(e){if(Object.keys(B.shortCuts).some(t=>t.split(",").includes(e.key))&&l.editMode){e.preventDefault(),B.keysPress[e.key]=!0;const t=B.shortCuts[Object.keys(B.shortCuts).find(s=>s.split(",").sort().join()===Object.keys(B.keysPress).filter(i=>B.keysPress[i]).map(i=>i).sort().join())];if(!t)return;t.action(e)}}static keyUp(e){B.keysPress[e.key]=!1}};B.keysPress={},B.shortCuts={};let b=B;const p=class p{static init(e,t,s,i=null){const o=i||e.querySelector("input, textarea")||e;this.elements[o.id]=e,this.offsetPosition=t,e.moverCallback=s,this.mouse={x:0,y:0},p.selectedSelectorId=o.id,document.body.addEventListener("pointermove",this.pointerMove),o.addEventListener("pointerdown",this.pointerDown),o.addEventListener("pointerup",this.pointerUp),b.set(e,["ArrowUp"],()=>this.moveByKey(0,-1)),b.set(e,["ArrowDown"],()=>this.moveByKey(0,1)),b.set(e,["ArrowRight"],()=>this.moveByKey(1)),b.set(e,["ArrowLeft"],()=>this.moveByKey(-1)),b.set(e,["Shift","ArrowUp"],()=>this.moveByKey(0,-10)),b.set(e,["Shift","ArrowDown"],()=>this.moveByKey(0,10)),b.set(e,["Shift","ArrowRight"],()=>this.moveByKey(10)),b.set(e,["Shift","ArrowLeft"],()=>this.moveByKey(-10)),b.set(e,["Control","ArrowUp"],()=>this.moveByKey(0,-50)),b.set(e,["Control","ArrowDown"],()=>this.moveByKey(0,50)),b.set(e,["Control","ArrowRight"],()=>this.moveByKey(50)),b.set(e,["Control","ArrowLeft"],()=>this.moveByKey(-50))}static resetElement(e){p.elements[e]&&(p.elements[e].removeEventListener("pointerdown",this.pointerDown),p.elements[e].removeEventListener("pointerup",this.pointerUp))}static async pointerDown(e){p.isPointerDown=!0,document.body.classList.add("isMoving"),p.selectedSelectorId=e.currentTarget.id||e.currentTarget.parentElement.id}static pointerMove(e){if(l.isDrawing)return;e.returnValue=!1;const t=p.elements[p.selectedSelectorId];if(t){const s=new WebKitCSSMatrix(getComputedStyle(t).transform);p.offsetPosition={x:p.offsetPosition.x+(p.mouse.x-s.m41),y:p.offsetPosition.y+(p.mouse.y-s.m42)},p.mouse.x=e.pageX+window.scrollX-p.offsetPosition.x,p.mouse.y=e.pageY+window.scrollY-p.offsetPosition.y,e.pressure!==0&&p.isPointerDown&&!U.isPointerDown&&(t.classList.add("hasMoved"),p.isMoving=!0,t.style.transform=`translate(${p.mouse.x}px, ${p.mouse.y}px)`)}}static pointerUp(){p.isMoving&&p.elements[p.selectedSelectorId].moverCallback(p.mouse),p.isPointerDown&&(p.isPointerDown=p.isMoving=!1,document.body.classList.remove("isMoving"))}static moveByKey(e,t=0){if(!w.selectedElementId)return;const s=p.elements[w.selectedElementId],i=new WebKitCSSMatrix(getComputedStyle(s).transform),o=i.m41+e,a=i.m42+t;setTimeout(()=>{s.style.transform=`translate(${o}px, ${a}px)`}),s.moverCallback({x:o,y:a})}};p.elements={},p.isMoving=!1,p.isPointerDown=!1;let D=p;class w{static init(){var e;(e=h.sheet.inputs)==null||e.concat(h.sheet.images).forEach(t=>{if(t){const s=document.querySelector(`label[for='${t.id}'], div[id='${t.id}']`);s.getAttribute("data-movable")||(D.init(s,{x:c.containerLeft,y:c.containerTop},i=>{s.tagName==="LABEL"&&h.addInputValues(t,"x",Math.round(i.x/c.ratio),"y",Math.round(i.y/c.ratio)),s.tagName==="DIV"&&h.addImageValues(t,"x",Math.round(i.x/c.ratio),"y",Math.round(i.y/c.ratio))}),U.init(s,{x:c.containerLeft,y:c.containerTop},i=>{s.tagName==="LABEL"&&h.addInputValues(t,"x",Math.round(i.x/c.ratio),"y",Math.round(i.y/c.ratio),"width",Math.round(i.width/c.ratio),"height",Math.round(i.height/c.ratio)),s.tagName==="DIV"&&h.addImageValues(t,"x",Math.round(i.x/c.ratio),"y",Math.round(i.y/c.ratio),"width",Math.round(i.width/c.ratio),"height",Math.round(i.height/c.ratio))}),s.setAttribute("data-movable","true"))}})}static delete(e){var s,i,o,a;const t=document.querySelector(`label[for='${e}'], div[id='${e}']`);if((t==null?void 0:t.tagName)==="LABEL"){const d=(s=h.sheet.inputs)==null?void 0:s.findIndex(r=>r.id===e);d!==-1&&((i=h.sheet.inputs)==null||i.splice(d,1),h.deletedInputs.push(e))}if((t==null?void 0:t.tagName)==="DIV"){const d=(o=h.sheet.images)==null?void 0:o.findIndex(r=>r.id===e);d!==-1&&((a=h.sheet.images)==null||a.splice(d,1),h.deletedImages.push(e))}l.isSaved=!1,S.render()}static async clone(e,t){const s=document.querySelector(`label[for='${t.id}'], div[id='${t.id}']`);(s==null?void 0:s.tagName)==="LABEL"&&h.addInputValues({...t,id:m.generateId().toString()}),(s==null?void 0:s.tagName)==="DIV"&&await h.addImageValues({...t,id:m.generateId().toString()}),this.select(e,t)}static copy(e){C.set(!1,"elementDatas",e)}static async paste(e,t){const s=document.querySelector(`label[for='${t.id}'], div[id='${t.id}']`),i=m.getMousePosition(),o={...await C.get("elementDatas"),x:Math.round((i.x-c.containerLeft)/c.ratio),y:Math.round((i.y-c.containerTop)/c.ratio),id:m.generateId().toString()};(s==null?void 0:s.tagName)==="LABEL"&&h.addInputValues(o),(s==null?void 0:s.tagName)==="DIV"&&await h.addImageValues(o),this.select(e,o)}static select(e=null,t=null){if(l.editMode&&(e&&e.stopPropagation(),this.selectedElementId=(t==null?void 0:t.id)||null,S.render(),t)){const s=document.querySelector(`label[for='${t.id}'], div[id='${t.id}']`);b.set(s,["Control","d"],i=>this.clone(i,t)),b.set(s,["Control","c"],()=>this.copy(t)),b.set(document.body,["Control","v"],i=>this.paste(i,t)),b.set(s,["Delete"],()=>this.delete(this.selectedElementId))}}}class y{static init(e,t,s){this.element=e,this.bd=Re.newDom(e),this.offsetPosition=t,this.callBack=s,this.resetMousePosition(),this.element.addEventListener("pointerdown",this.pointerDown),this.element.addEventListener("pointermove",this.pointerMove),b.set(document.body,["Escape"],()=>{this.reset(),l.displayEditBlock(!0)})}static resetMousePosition(){this.mouse={x:0,y:0,startX:0,startY:0}}static pointerDown(){l.isDrawing=!0,y.element.addEventListener("click",y.pointerUp),y.mouse.startX=y.mouse.x,y.mouse.startY=y.mouse.y,y.bd.elt("div","rectangle").att("style",`left:${y.mouse.x}px;top:${y.mouse.y}px;cursor:crosshair;`)}static pointerMove(e){e.returnValue=!1,y.mouse.x=e.pageX+window.scrollX-y.offsetPosition.x,y.mouse.y=e.pageY+window.scrollY-y.offsetPosition.y,e.pressure!==0&&y.bd.att("style",`width:${Math.abs(y.mouse.x-y.mouse.startX)}px;height:${Math.abs(y.mouse.y-y.mouse.startY)}px;left:${y.mouse.x-y.mouse.startX<0?`${y.mouse.x}px`:`${y.mouse.startX}px`};top:${y.mouse.y-y.mouse.startY<0?`${y.mouse.y}px`:`${y.mouse.startY}px`}`)}static async pointerUp(e){D.isPointerDown=!1,await y.callBack(y.mouse,e),y.bd.current().remove(),y.reset()}static reset(){l.isDrawing=!1,this.resetMousePosition(),this.element.removeEventListener("pointerdown",this.pointerDown),this.element.removeEventListener("pointermove",this.pointerMove),this.element.removeEventListener("click",this.pointerUp)}}class $t{static add(){l.displayEditBlock(!1),y.init(c.element.querySelector(".wrapper"),{x:c.containerLeft,y:c.containerTop},async(e,t)=>{l.displayEditBlock(!0);const i={id:m.generateId().toString(),type:"text"};await h.addInputValues(i,"x",Math.round(e.startX/c.ratio),"y",Math.round(e.startY/c.ratio),"width",Math.round(e.x/c.ratio-e.startX/c.ratio),"height",Math.round(e.y/c.ratio-e.startY/c.ratio)),w.select(t,i)})}}let bt=class{static add(){l.displayEditBlock(!1),y.init(c.element.querySelector(".wrapper"),{x:c.containerLeft,y:c.containerTop},async(e,t)=>{const s={id:m.generateId().toString()};let i;m.confirm(g`
					<label for="file">
						<span>Choisissez un fichier</span>
						<input type="file" id="file" name="file" @change="${o=>{i=o.target.files[0]}}">
					</label>
				`,async()=>{await h.addImageValues(s,"x",Math.round(e.startX/c.ratio),"y",Math.round(e.startY/c.ratio),"width",Math.round(e.x/c.ratio-e.startX/c.ratio),"height",Math.round(e.y/c.ratio-e.startY/c.ratio),"file",i),w.select(t,s),l.displayEditBlock(!0),l.isSaved=!1},()=>l.displayEditBlock(!0))})}};const wt=(n,e)=>[{id:"id",type:"hidden",name:"id",value:n.id},{id:"type",type:"select",name:"Type",value:n.type,options:[{name:"Texte court",value:"text"},{name:"Texte long",value:"textarea"},{name:"Nombre",value:"number"}]},{id:"fontFamily",type:"select",name:"Police",value:n.fontFamily,options:e},{id:"fontSize",type:"number",name:"Taille de la police",value:n.fontSize},{id:"color",type:"color",name:"Couleur de la police",value:n.color},{id:"textAlign",type:"select",name:"Alignement",value:n.textAlign,options:[{name:"Gauche",value:"left"},{name:"Centré",value:"center"},{name:"Droite",value:"right"},{name:"Justifié",value:"justify"}]},{id:"width",type:"number",name:"Largeur",value:n.width},{id:"height",type:"number",name:"Hauteur",value:n.height},{id:"x",type:"number",name:"Abscisse",value:n.x},{id:"y",type:"number",name:"Ordonnée",value:n.y}];var k=(n=>(n.hover="hover",n.movable="movable",n.hidden="hidden",n))(k||{});class W{static initializeMove(e){b.set(document.body,["Tab"],()=>{l.interface===k.hover?this.changeInterface(k.movable):l.interface===k.movable?this.changeInterface(k.hidden):l.interface===k.hidden&&this.changeInterface(k.hover)}),l.interface===k.movable&&l.editMode&&e?D.init(e,{x:c.containerLeft,y:c.containerTop},t=>{l.isSaved=!1,S.render();const s={};s[e.classList[0]]=t,h.sheetProperties.push({setUIBlocksPosition:s})},e):D.resetElement("editBlock")}static viewBlock(){return g`
			<div class="viewBlock">
				<a href="#" role="button" class="viewSelection ${l.interface===k.hover?"selected":""}" @click="${e=>{e.preventDefault(),this.changeInterface(k.hover)}}" title="Interface sur demande">
					<svg class="eye-plus">
						<use href="#eye-plus"></use>
					</svg>
				</a>
				<a href="#" role="button" class="viewSelection ${l.interface===k.movable?"selected":""}" @click="${e=>{e.preventDefault(),this.changeInterface(k.movable)}}" title="Interface toujours visible et déplaçable">
					<svg class="eye">
						<use href="#eye"></use>
					</svg>
				</a>
				<a href="#" role="button" class="viewSelection ${l.interface===k.hidden?"selected":""}" @click="${e=>{e.preventDefault(),this.changeInterface(k.hidden)}}" title="Interface cachée">
					<svg class="eye-blocked">
						<use href="#eye-blocked"></use>
					</svg>
				</a>
				<a href="#" role="button" ?disabled="${l.isSaved}" class="saveButton" @click="${async e=>{e.preventDefault(),await h.save(),S.render()}}" title="Sauvegarder">
					<svg class="floppy">
						<use href="#floppy"></use>
					</svg>
				</a>
			</div>
		`}static editBlock(){var t,s;setTimeout(()=>this.initializeMove(document.querySelector(".editBlock")));const e=l.interface==="movable"&&h.sheet.ui&&h.sheet.ui.editBlock;return g`
			<article .hidden="${l.isEditBlockHidden}" class="editBlock${e?" hasMoved":""}" id="editBlock" style="${e?`transform: translate(${(t=h.sheet.ui)==null?void 0:t.editBlock.x}px, ${(s=h.sheet.ui)==null?void 0:s.editBlock.y}px);`:""}">
				${l.interface!=="hidden"?this.viewBlock():""}
				<button class="contrast" @click="${()=>c.editBackgroundImage()}">Image de fond</button>
				<button class="contrast" @click="${()=>c.changeBackgroundColor()}">Couleur du fond</button>
				<button class="contrast" @click="${()=>c.addFont()}">Ajouter une police</button>
				<button class="contrast" @click="${()=>c.deleteFont()}">Supprimer une police</button>
				<button class="contrast" @click="${()=>$t.add()}">Ajouter un champ</button>
				<button class="contrast" @click="${()=>bt.add()}">Ajouter une image</button>
				<div class="validBlock">
					<button @click="${()=>{l.displayEditMode(!1)}}">Annuler
					</button>
					<button class="save" @click="${async()=>{await h.save(),l.displayEditMode(!1)}}">Enregistrer et fermer
						<fs-loader ?visible="${h.isSaving}"></fs-loader>
					</button>
				</div>
			</article>
		`}static selectBlock(e){var s,i;setTimeout(()=>this.initializeMove(document.querySelector(".selectBlock")));const t=l.interface==="movable"&&h.sheet.ui&&h.sheet.ui.selectBlock;return g`
			<article id="selectBlock" class="selectBlock${t?" hasMoved":""}" @click="${o=>o.stopPropagation()}" style="${t?`transform: translate(${(s=h.sheet.ui)==null?void 0:s.selectBlock.x}px, ${(i=h.sheet.ui)==null?void 0:i.selectBlock.y}px);`:""}">
				<a href="#" role="button" class="cloneInput" @click="${o=>{o.preventDefault(),w.clone(o,e)}}" title="Dupliquer (ctrl D)">
					<svg class="clone">
						<use href="#clone"></use>
					</svg>
				</a>
				<a href="#" role="button" class="deleteInput" @click="${o=>{o.preventDefault(),w.delete(e.id)}}" title="Supprimer (Suppr)">
					<svg class="trash">
						<use href="#trash"></use>
					</svg>
				</a>
				${wt(e,h.sheet.fonts&&h.sheet.fonts.map(o=>({name:o.fontFamily,value:o.fontFamily}))).filter(o=>e.type||e.image&&e[o.id]).map(o=>g`
					<fs-label
							id="${o.id}"
							type="${o.type}"
							name="${o.name}"
							value="${o.value}"
							@input="${a=>h.addInputValues(e,o.id,a.target.value)}"
							options="${JSON.stringify(o.options)}"
					></fs-label>
				`)}
			</article>
		`}static changeInterface(e){l.interface=e,h.sheetProperties.push({setUIBlocksInterface:{interface:l.interface}}),l.isSaved=!1,S.render()}}class S{static render(){var e,t,s;E(g`
			<style>
				${(e=h.sheet.fonts)==null?void 0:e.map(i=>`
				@font-face {
				font-family: ${i.fontFamily};
				src: url(${i.fontUrl});
				}
				`)}
			</style>
		`,document.head),E(g`			
				<div style="position: relative;width: ${c.containerWidth};height: ${c.containerHeight};" class="wrapper ${l.editMode&&"editMode"} ${l.notepadMode&&"notepadMode"} ${l.interface||k.hover}" @click="${i=>{l.editMode&&w.select(i),l.notepadMode&&l.displayNotepadMode(!1)}}">
				${l.interface==="hidden"?W.viewBlock():""}
				${l.editMode?W.editBlock():g`
					<fs-link role="button" class="home contrast" href="/">
						<svg class="home"> 
							<use href="#home"></use>
						</svg>
						<span>Accueil</span>
					</fs-link>
					<button class="edit contrast" @click="${()=>l.displayEditMode(!0)}">Éditer</button>
					<button class="notepad contrast ${l.notepadMode&&"selected"}" @click="${i=>{i.stopPropagation(),l.displayNotepadMode(!l.notepadMode)}}">Bloc notes</button>
					<button class="print contrast" @click="${()=>c.printScreen()}">
						<svg class="print"> 
							<use href="#print"></use>
						</svg>
						<span>Imprimer</span>
					</button>
					${l.notepadMode?g`
					<article id="notepad" @click="${i=>i.stopPropagation()}">
						<textarea @change="${i=>h.saveNotepad(i.target.value)}">${h.sheet.notepad}</textarea>
					</article>
					`:""}
				`}
				${(t=h.sheet.inputs)==null?void 0:t.map(i=>g`
							<label for="${i.id}" style="transform: translate(${i.x*c.ratio}px, ${i.y*c.ratio}px);" class="${w.selectedElementId===i.id?"selected":""}">
								${i.type==="textarea"?g`
									<textarea
											id="${i.id}"
											name="${i.id}"
											style="font-size: ${i.fontSize*c.ratio}px;width: ${i.width*c.ratio}px;height: ${i.height*c.ratio}px;color: ${i.color};text-align: ${i.textAlign};font-family: ${i.fontFamily};"
											@change="${o=>h.addAndSaveInput(i,"value",o.target.value)}"
											?readonly="${l.editMode}"
											@click="${o=>w.select(o,i)}"
									>${i.value}</textarea>
								`:g`
									<input
											type="${i.type}"
											id="${i.id}"
											name="${i.id}"
											value="${i.value}"
											style="font-size: ${i.fontSize*c.ratio}px;width: ${i.width*c.ratio}px;height: ${i.height*c.ratio}px;color: ${i.color};text-align: ${i.textAlign};font-family: ${i.fontFamily};"
											@change="${o=>h.addAndSaveInput(i,"value",o.target.value)}"
											?readonly="${l.editMode}"
											@click="${o=>w.select(o,i)}"
									/>
								`}
								${U.boxPositions.map(o=>g`<div .hidden="${w.selectedElementId!==i.id}" class="resizeHandler ${o.class}" />`)}
							</label>
							${w.selectedElementId===i.id?W.selectBlock(i):""}
						`)}
				${(s=h.sheet.images)==null?void 0:s.map(i=>g`
							<div id="${i.id}" style="transform: translate(${i.x*c.ratio}px, ${i.y*c.ratio}px);width: ${i.width*c.ratio}px;height: ${i.height*c.ratio}px;" class="image ${w.selectedElementId===i.id?"selected":""} ${l.isZoomed===i.id?"isZoomed":""}" @click="${o=>{l.editMode?w.select(o,i):(l.isZoomed?l.isZoomed=!1:l.isZoomed=i.id,S.render())}}">
								<div style="background-image: url(${i.image});"></div>
								${U.boxPositions.map(o=>g`<div .hidden="${w.selectedElementId!==i.id}" class="resizeHandler ${o.class}" />`)}
							</div>
							${w.selectedElementId===i.id?W.selectBlock(i):""}
						`)}
			</div>
		`,c.element),w.init()}}const _=class _{static displayEditMode(e){w.select(),this.editMode=e,this.notepadMode=this.notepadMode&&!e,h.changedInputs=[],h.changedImages=[],h.deletedInputs=[],h.deletedImages=[],h.sheetProperties=[],S.render()}static displayNotepadMode(e){this.notepadMode=e,S.render()}static displayEditBlock(e){U.isPointerDown||D.isPointerDown||(this.isEditBlockHidden=!e,S.render())}};_.interface=k.hover,_.isSaved=!0,_.isDrawing=!1,_.isZoomed=!1;let l=_;const ye=class ye{static async init(){m.loader(!0);const e=location.pathname.split("/"),t=await C.get("sheets")||await m.request("/db","POST",{body:'{ "getSheets": "" }'});C.set(!0,"sheets",t),this.sheet=t.find(s=>s.slug===e[e.length-1]),this.id=this.sheet._id,this.sheet=await C.get(this.id)||this.sheet,await this.cacheResources()}static async addAndSaveInput(e,...t){this.addInputValues(e,...t),await this.save(e)}static async saveNotepad(e){this.sheet.notepad=e,this.sheetProperties=[{setNotepad:{text:e}}],await this.save()}static addInputValues(e,...t){for(let i=0;i<t.length;i++){const o=t[i+1];i%2===0&&(e[t[i]]=Number(o)||o)}let s;this.sheet.inputs||(this.sheet.inputs=[]),l.editMode&&(s=this.changedInputs.findIndex(i=>i.id===e.id),this.changedInputs[s!==-1?s:this.changedInputs.length||0]=e),s=this.sheet.inputs.findIndex(i=>i.id===e.id),this.sheet.inputs[s!==-1?s:this.sheet.inputs.length||0]=e,l.isSaved=!1,S.render()}static async addImageValues(e,...t){for(let i=0;i<t.length;i++){const o=t[i+1];i%2===0&&(e[t[i]]=Number(o)||o)}let s;l.editMode&&(s=this.changedImages.findIndex(i=>i.id===e.id),this.changedImages[s!==-1?s:this.changedImages.length||0]=e),this.sheet.images||(this.sheet.images=[]),s=this.sheet.images.findIndex(i=>i.id===e.id),e.file&&(e.image=await m.getBase64FromFileReader(e.file)),this.sheet.images[s!==-1?s:this.sheet.images.length||0]=e,l.isSaved=!1,S.render()}static async cacheResources(){var t,s,i,o,a,d;const e=await C.get(this.id);if(m.isValidHttpUrl(this.sheet.backgroundImage)&&(this.sheet.backgroundImage_url=this.sheet.backgroundImage,this.sheet.backgroundImage=(e==null?void 0:e.backgroundImage)||this.sheet.backgroundImage,((e==null?void 0:e.backgroundImage)!==this.sheet.backgroundImage&&(e==null?void 0:e.backgroundImage_url)!==this.sheet.backgroundImage||!e)&&(this.sheet.backgroundImage=await m.urlToBase64(this.sheet.backgroundImage))),this.sheet.images)for(let r=0;r<this.sheet.images.length;r++){const u=this.sheet.images[r];m.isValidHttpUrl(u.image)&&(u.image_url=u.image,u.image=(e==null?void 0:e.images)&&((t=e==null?void 0:e.images[r])==null?void 0:t.image)||u.image,(e!=null&&e.images&&((s=e==null?void 0:e.images[r])==null?void 0:s.image)!==u.image&&(e!=null&&e.images)&&((i=e==null?void 0:e.images[r])==null?void 0:i.image_url)!==u.image||!e)&&(u.image=await m.urlToBase64(u.image)))}if(this.sheet.fonts)for(let r=0;r<this.sheet.fonts.length;r++){const u=this.sheet.fonts[r];m.isValidHttpUrl(u.fontUrl)&&(u.fontUrl_url=u.fontUrl,u.fontUrl=(e==null?void 0:e.fonts)&&((o=e==null?void 0:e.fonts[r])==null?void 0:o.fontUrl_url)||u.fontUrl,(e!=null&&e.fonts&&((a=e.fonts[r])==null?void 0:a.fontUrl)!==u.fontUrl&&((d=e==null?void 0:e.fonts[r])==null?void 0:d.fontUrl_url)!==u.fontUrl||!e)&&(u.fontUrl=await m.urlToBase64(u.fontUrl)))}C.set(!0,this.id,this.sheet)}static async save(e=null){var o,a;this.isSaving=!0;const t=[],s=e?[e]:this.changedInputs;if(s==null||s.forEach(d=>{t.push({setInput:{id:this.id,inputId:d.id,input:d}})}),!e){if((o=this.deletedInputs)==null||o.forEach(d=>{t.push({deleteInput:{id:this.id,inputId:d}})}),this.changedImages)for(const d of this.changedImages)d.file&&(d.image=await m.uploadFileAndGetUrl(d.file),delete d.file),d.image_url&&(d.image=d.image_url,delete d.image_url),t.push({setImage:{id:this.id,imageId:d.id,image:d}});(a=this.deletedImages)==null||a.forEach(d=>{t.push({deleteImage:{id:this.id,imageId:d}})});for(const d of this.sheetProperties){const r=Object.values(d)[0];Object.keys(d)[0]==="setBackgroundImage"&&(r.image=await m.uploadFileAndGetUrl(r.image)),Object.keys(d)[0]==="setFont"&&(r.fontUrl=await m.uploadFileAndGetUrl(r.fontUrl,r.name)),r.id=this.id,t.push(d)}}const i=(await m.request("/db","POST",{body:JSON.stringify(t)})).pop();i&&(this.sheet=i.find(d=>d._id===this.id),await C.set(!0,"sheets",i),await this.cacheResources(),this.changedInputs=[],this.changedImages=[],this.deletedInputs=[],this.deletedImages=[],this.sheetProperties=[],this.isSaving=!1,l.isSaved=!0)}};ye.isSaving=!1;let h=ye;class c extends HTMLElement{async connectedCallback(){await h.init(),c.element=this,this.style.backgroundColor=h.sheet.backgroundColor,c.setBackgroundImage(h.sheet.backgroundImage||"../../assets/default.jpg"),window.addEventListener("resize",()=>c.resize()),b.set(document.body,["Control","s"],async()=>{await h.save(),S.render()})}static setBackgroundImage(e){const t=new Image;t.onload=()=>{this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight,this.resize()},t.src=e,this.element.style.backgroundImage=`url(${t.src})`}static resize(){const e=document.body.getBoundingClientRect();this.element.style.width=`${e.width}px`,this.element.style.height=`${e.height}px`;const t=e.width*this.imageHeight/this.imageWidth,s=t<e.height;this.containerWidth=`${s?e.width:this.imageWidth*e.height/this.imageHeight}px`,this.containerHeight=`${s?t:e.height}px`,this.ratio=s?e.width/this.imageWidth:e.height/this.imageHeight,this.containerLeft=(e.width-parseInt(this.containerWidth))/2,this.containerTop=(e.height-parseInt(this.containerHeight))/2,S.render(),setTimeout(()=>m.loader(!1))}static changeBackgroundColor(){l.displayEditBlock(!1);let e;m.confirm(g`
			<label for="color">
				<span>Choisissez une couleur</span>
				<input type="color" id="color" name="color" value="${h.sheet.backgroundColor||"#ffffff"}" @change="${async t=>{e=t.target.value}}">
			</label>
		`,()=>{this.element.style.backgroundColor=e,h.sheet.backgroundColor=e,h.sheetProperties.push({setBackgroundColor:{color:e}}),l.isSaved=!1,l.displayEditBlock(!0),S.render()},()=>l.displayEditBlock(!0))}static editBackgroundImage(){l.displayEditBlock(!1);let e;m.confirm(g`
			<label for="file">
				<span>Choisissez un fichier</span>
				<input type="file" id="file" name="file" @change="${t=>{e=t.target.files[0]}}">
			</label>
		`,async()=>{this.setBackgroundImage(await m.getBase64FromFileReader(e)),h.sheetProperties.push({setBackgroundImage:{image:e}}),l.isSaved=!1,l.displayEditBlock(!0),S.render()},()=>l.displayEditBlock(!0))}static addFont(){l.displayEditBlock(!1);let e,t,s;m.confirm(g`
			<label for="file">
				<input accept=".ttf,.woff,.woff2,.eot" type="file" id="file" name="file" @change="${i=>{s=i.target.files[0]}}">
			</label>
			<label for="fontFamily">
				<span>Nom de la police (font family)</span>
				<input type="text" id="fontFamily" name="fontFamily" @change="${async i=>{t=i.target.value}}">
			</label>
		`,async()=>{h.sheet.fonts||(h.sheet.fonts=[]),e=await m.getBase64FromFileReader(s);const i={name:s.name,fontUrl:e,fontFamily:t};h.sheet.fonts.push(i),e=s,h.sheetProperties.push({setFont:i}),l.isSaved=!1,l.displayEditBlock(!0),S.render()},()=>l.displayEditBlock(!0))}static deleteFont(){var t;l.displayEditBlock(!1);let e=[];m.confirm(g`
			<ul>
				${(t=h.sheet.fonts)==null?void 0:t.map(s=>g`
					<li>
						<label for="${s.fontFamily}">
							<input type="checkbox" id="${s.fontFamily}" name="${s.fontFamily}" value="${s.fontFamily}" @change="${i=>{const o=s.fontFamily;i.target.checked?e.push(o):e=e.filter(a=>a!==o)}}">${s.fontFamily}</label>
					</li>
				`)}
			</ul>
		`,()=>{e.forEach(s=>{var i;h.sheet.fonts=(i=h.sheet.fonts)==null?void 0:i.filter(o=>o.fontFamily!==s)}),h.sheetProperties.push({deleteFont:{fonts:e}}),l.isSaved=!1,l.displayEditBlock(!0),S.render()},()=>l.displayEditBlock(!0))}static async printScreen(){}}class At extends HTMLElement{constructor(){super(...arguments),this.message=""}static get observedAttributes(){return["open"]}get open(){return this.hasAttribute("open")}set open(e){e?this.setAttribute("open",""):this.removeAttribute("open")}connectedCallback(){this.render(),this.style.display="none"}attributeChangedCallback(e,t,s){e==="open"&&t!==s&&(this.style.display="",setTimeout(()=>this.render(),50))}closeDialog(){this.open=!1,setTimeout(()=>{this.style.display="none",this.message="",this.render()},225)}render(){E(g`
						<dialog ?open="${this.open}"> 
								<article>
										${this.message} 
										<footer>
												<a role="button" class="secondary" @click="${e=>{e.preventDefault(),this.dispatchEvent(new CustomEvent("modalCancel")),this.closeDialog()}}">Cancel</a>
																	<a role="button" @click="${e=>{e.preventDefault(),this.dispatchEvent(new CustomEvent("modalConfirm")),this.closeDialog()}}">Confirm</a>
										</footer>
								</article>
						</dialog>
		`,this)}}class St extends HTMLElement{connectedCallback(){this.render(),this.setFormListener()}setFormListener(){const e=this.querySelector("form");e==null||e.addEventListener("submit",async t=>{t.preventDefault(),await m.request("/auth","POST",{body:JSON.stringify(Object.fromEntries(new FormData(e).entries()))}),location.href="/"})}render(){E(g`
					<form>
						<label>
							<span>Identifiant</span>
							<input name="id" required type="text">
						</label>
						<label>
							<span>Mot de passe</span>
							<input name="password" required type="password">
						</label>
						<button type="submit">
							<span>Envoyer</span>
						</button>
					</form>
		`,this)}}class xt extends HTMLElement{static get observedAttributes(){return["value"]}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get value(){return this.getAttribute("value")}set value(e){this.setAttribute("value",e)}get type(){return this.getAttribute("type")}set type(e){this.setAttribute("type",e)}get options(){return JSON.parse(this.getAttribute("options")||"[]")}set options(e){this.setAttribute("options",e)}connectedCallback(){this.render()}attributeChangedCallback(e,t,s){e==="value"&&t!==s&&(this.value=s,this.render())}render(){var e;E(g`
			<label for="${this.id}" @click="${t=>t.stopPropagation()}">
				<span>${this.name}</span>
				${this.type==="select"?g`
					<select id="${this.id}" title="${this.name}">
						<option value="" selected>Choisir un ${this.name}</option>
						${(e=this.options)==null?void 0:e.map(t=>g`
							<option ?selected="${this.value===t.value}" value="${t.value}">${t.name}</option>
						`)}
					</select>
				`:g`
					<input type="${this.type}" id="${this.id}" name="${this.id}" value="${this.value}" title="${this.name}"/>
				`}
			</label>
		`,this)}}class kt extends HTMLElement{constructor(){super(...arguments),this.sheets=[],this.editMode=null}async connectedCallback(){m.getFragmentHtml(location.pathname),m.loader(!0),this.sheets=await C.get("sheets")||await m.request("/db","POST",{body:'{ "getSheets": "" }'}),C.set(!0,"sheets",this.sheets),this.sheets=Array.isArray(this.sheets)?this.sheets:Object.keys(this.sheets).length?[this.sheets]:[],this.render(),window.addEventListener("resize",()=>this.initParchment()),setTimeout(()=>{this.initParchment(),m.loader(!1)})}initParchment(){if(!document.querySelector("#parchment"))return;const e=document.querySelector("#main");e.style.height="",document.body.style.height="";const t=e.getBoundingClientRect();t.height<=window.innerHeight&&(document.body.style.height=`${window.innerHeight}px`,e.style.height=`${document.body.getBoundingClientRect().height-t.top-parseInt(getComputedStyle(e).marginBottom)}px`),this.render()}async saveSheet(e){this.sheets.some(t=>(t.name.toLowerCase()===e.name.toLowerCase()||t.slug===m.slugify(e.name))&&t._id!==e.id)?m.toast("error","Une feuille de personnage portant le même nom ou la même url existe"):(this.sheets=await m.request("/db","POST",{body:`{ "setSheet": ${JSON.stringify(e)} }`}),C.set(!0,"sheets",this.sheets)),this.resetMode()}async editSheets(e,t){var o;const s=e.target,i=s.tagName==="INPUT"?s:(o=s.closest("div"))==null?void 0:o.querySelector("input");await this.saveSheet({name:i.value,id:t})}addSheet(){let e;m.confirm(g`
			<label for="name">
				<span>Choisissez un nom</span>
				<input type="text" id="name" name="name" @change="${async t=>{e=t.target.value}}"> 
			</label>
		`,async()=>{await this.saveSheet({name:e}),this.initParchment()})}removeSheet(e){m.confirm(g`<h3>Voulez-vous vraiment supprimer ?</h3>`,async()=>{this.sheets=await m.request("/db","POST",{body:`{ "removeSheet": { "id": "${e}" } }`}),C.set(!0,"sheets",this.sheets),this.resetMode(),this.initParchment(),m.toast("success","Feuille de personnage supprimée")})}clone(e){let t;m.confirm(g`
			<label for="name">
				<span>Dupliquer la feuille de personnage</span>
				<input type="text" id="name" name="name" @change="${s=>{t=s.target.value}}"> 
			</label>
		`,async()=>{const s=this.sheets.find(i=>i._id===e);s.name=t,s.slug=m.slugify(t),delete s._id,delete s.id,await this.saveSheet(s),this.initParchment()})}resetMode(){this.editMode=null,this.render()}resetHeight(){document.querySelector("#main").style.height="",document.body.style.height=""}render(){E(g`
			<div class="title">
				<h2>Vos feuilles de personnage</h2>
				<button type="button" class="add" @click="${()=>this.addSheet()}">
					<svg class="add">
						<use href="#document"></use>
					</svg>
					<span>Ajouter une feuille</span> 
				</button>
			</div>
			<aside>
				<nav>
					<ul>
						${this.sheets.length?this.sheets.map(e=>{const t=e._id,s=e.name;return g`
				<li>
					<div class="characterSheets">
						${this.editMode===t?g`
							<input name="editSheet" required type="text" value="${s}" @keyup="${i=>{i.key==="Enter"&&this.editSheets(i,t),i.key==="Escape"&&this.resetMode()}}"/>
							<button class="valid" @click="${async i=>await this.editSheets(i,t)}">
								<svg class="valid">
									<use href="#valid"></use>
								</svg>
								<span>Valider</span>
							</button>
							<button type="button" class="undo" @click="${()=>this.resetMode()}">
								<svg class="undo">
									<use href="#undo"></use>
								</svg>
								<span>Annuler</span>
							</button>
						`:g`
							<fs-link role="link" href="/sheets/${e.slug}" @click="${()=>this.resetHeight()}">
								<span>${s}</span>
							</fs-link>
							<button type="button" class="clone" @click="${()=>this.clone(t)}">
								<svg class="clone">
									<use href="#documents"></use>
								</svg>
								<span>Dupliquer</span>
							</button>
							<button class="edit" @click="${()=>{this.editMode=t,this.render()}}">
								<svg class="edit">
									<use href="#pencil"></use>
								</svg>
								<span>Modifier</span>
							</button>
							<button type="button" class="remove" @click="${()=>this.removeSheet(t)}">
								<svg class="remove">
									<use href="#bin"></use>
								</svg>
								<span>Supprimer</span>
							</button>
						`}
					</div>
				</li>											
				`}):g`<li>Aucune feuille ...</li>`}
					</ul>
				</nav>
			</aside>
		`,this)}}class Ct extends HTMLElement{get href(){return this.getAttribute("href")}set href(e){this.setAttribute("open",e)}async connectedCallback(){var s;const e=Array.from(this.children);this.render(),(s=this.querySelector("slot"))==null||s.replaceWith(...e);const t=await m.getFragmentHtml(this.href);this.addEventListener("click",()=>{history.pushState({},"",this.href),qe(t)})}render(){E(g`
			<slot></slot>
		`,this)}}const qe=n=>{m.replaceChildren(document.querySelector("[data-replaced-zone]"),document.createRange().createContextualFragment(n.text)),document.body.className=n.class;const e=document.querySelector("[data-replaced-title]");e&&(e.innerHTML=n.title)};window.addEventListener("popstate",async()=>qe(await m.getFragmentHtml(location.pathname)));class Bt{constructor(){m.helpers(),location.href.charAt(location.href.length-1)==="/"&&history.replaceState({},"",location.href.replace(/\/$/,""))}}new Bt;customElements.define("fs-loader",vt);customElements.define("fs-confirm",At);customElements.define("fs-home",kt);customElements.define("fs-sheet",c);customElements.define("fs-label",xt);customElements.define("fs-login",St);customElements.define("fs-link",Ct);
